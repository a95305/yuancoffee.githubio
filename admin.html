<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Yuan Coffee å¾Œå°ç®¡ç†ç³»çµ±</title>
    <style>
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; padding: 30px; background: #F9F5F0; color: #5D4037; }
        .admin-card { background: white; padding: 25px; border-radius: 15px; max-width: 500px; margin: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #E0D5C1; padding-bottom: 10px; margin-bottom: 20px; }
        label { font-weight: bold; display: block; margin-top: 15px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #DDD; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        
        .primary-btn { width: 100%; padding: 14px; background: #5D4037; color: white; border: none; border-radius: 30px; cursor: pointer; font-weight: bold; font-size: 1rem; margin-top: 20px; transition: 0.3s; }
        .primary-btn:hover { background: #8D6E63; }
        
        .status { text-align: center; margin-top: 15px; font-size: 0.9rem; font-weight: bold; min-height: 1.2rem; }

        /* å‰å°æ¨£å¼æ¨¡æ“¬ UI */
        .preview-section { max-width: 500px; margin: 40px auto; }
        .dessert-title { border-left: 5px solid #5D4037; padding-left: 15px; font-size: 1.5rem; font-weight: bold; margin-bottom: 20px; }
        
        .dessert-item { display: flex; justify-content: space-between; align-items: flex-start; padding: 15px 0; border-bottom: 1px dashed #D1C4E9; position: relative; }
        .dessert-info { flex-grow: 1; }
        .dessert-name { font-size: 1.1rem; font-weight: bold; margin: 0; }
        .dessert-note { font-size: 0.85rem; color: #8D6E63; background: #EFEBE9; padding: 2px 8px; border-radius: 4px; display: inline-block; margin-top: 5px; }
        .dessert-price { font-size: 1.1rem; font-weight: bold; margin-left: 20px; }
        
        .delete-btn { background: #FF5252; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer; margin-left: 15px; font-size: 0.8rem; transition: 0.3s; }
        .delete-btn:hover { background: #D32F2F; }
    </style>
</head>
<body>

    <div class="admin-card">
        <h2>ğŸ° æ–°å¢ä»Šæ—¥ç”œé»</h2>
        <label>ç”œé»åç¨±</label>
        <input type="text" id="name" placeholder="ä¾‹å¦‚ï¼šè‰è“å¡”">
        <label>åƒ¹æ ¼</label>
        <input type="text" id="price" placeholder="ä¾‹å¦‚ï¼š$200">
        <label>å‚™è¨»æ¨™ç±¤ (å¯ä¸å¡«)</label>
        <input type="text" id="note" placeholder="ä¾‹å¦‚ï¼šæ¯æ—¥é™é‡ä¾›æ‡‰">
        
        <button id="addBtn" class="primary-btn">ç¢ºèªä¸Šæ¶ç”œé»</button>
        <p id="status" class="status"></p>
    </div>

    <div class="preview-section">
        <div class="dessert-title">DESSERT æ‰‹åšç”œé»</div>
        <div id="dessertList">
            <p style="text-align:center; color:#999;">è®€å–ä¸­...</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        const SUPABASE_URL = 'https://yqedcpfjbkyjgmauahze.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_2aql_gXkY9fdY6rImYeOyw_M6-opiCM';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // åˆå§‹åŒ–æ™‚æŠ“å–æ¸…å–®
        fetchDesserts();

        // å‡½æ•¸ï¼šæŠ“å–æ‰€æœ‰ç”œé»ä¸¦é¡¯ç¤º
        async function fetchDesserts() {
            const listEl = document.getElementById('dessertList');
            
            const { data, error } = await supabaseClient
                .from('daily_desserts')
                .select('*')
                .order('created_at', { ascending: false }); // æœ€æ–°ç™¼å¸ƒçš„åœ¨ä¸Šé¢

            if (error) {
                listEl.innerHTML = "è®€å–è³‡æ–™å¤±æ•—";
                return;
            }

            if (data.length === 0) {
                listEl.innerHTML = "<p style='text-align:center; color:#999;'>ç›®å‰æ²’æœ‰ç”œé»ä¸Šæ¶ä¸­</p>";
                return;
            }

            listEl.innerHTML = data.map(item => `
                <div class="dessert-item">
                    <div class="dessert-info">
                        <p class="dessert-name">${item.name}</p>
                        ${item.note ? `<span class="dessert-note">${item.note}</span>` : ''}
                    </div>
                    <div class="dessert-price">${item.price}</div>
                    <button class="delete-btn" onclick="deleteDessert(${item.id})">åˆªé™¤</button>
                </div>
            `).join('');
        }

        // å‡½æ•¸ï¼šæ–°å¢ç”œé»
        async function addDessert() {
            const name = document.getElementById('name').value;
            const price = document.getElementById('price').value;
            const note = document.getElementById('note').value;
            const statusEl = document.getElementById('status');

            if(!name || !price) {
                alert("åç¨±èˆ‡åƒ¹æ ¼ä¸èƒ½ç‚ºç©ºï¼");
                return;
            }

            statusEl.innerText = "ä¸Šæ¶ä¸­...";
            statusEl.style.color = "orange";

            // æ”¹ç”¨ .insert æ–°å¢è³‡æ–™
            const { error } = await supabaseClient
                .from('daily_desserts')
                .insert([{ name, price, note }]);

            if (!error) {
                statusEl.innerText = "âœ… ä¸Šæ¶æˆåŠŸï¼";
                statusEl.style.color = "green";
                // æ¸…ç©ºè¼¸å…¥æ¡†
                document.getElementById('name').value = '';
                document.getElementById('price').value = '';
                document.getElementById('note').value = '';
                // é‡æ–°åˆ·æ–°åˆ—è¡¨
                fetchDesserts();
            } else {
                statusEl.innerText = "âŒ å¤±æ•—ï¼š" + error.message;
                statusEl.style.color = "red";
            }
        }

        // å‡½æ•¸ï¼šåˆªé™¤ç”œé»
        async function deleteDessert(id) {
            if(!confirm("ç¢ºå®šè¦ä¸‹æ¶é€™ä»½ç”œé»å—ï¼Ÿ")) return;

            const { error } = await supabaseClient
                .from('daily_desserts')
                .delete()
                .eq('id', id);

            if (!error) {
                fetchDesserts(); // åˆ·æ–°åˆ—è¡¨
            } else {
                alert("åˆªé™¤å¤±æ•—ï¼š" + error.message);
            }
        }

        document.getElementById('addBtn').addEventListener('click', addDessert);
    </script>
</body>
</html>
